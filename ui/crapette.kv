#:kivy 1.11.0

FloatLayout:
    BoxLayout:
        orientation: "vertical"
        size: root.size

        canvas:
            Color:
                rgb: 0, 0.5, 0
            Rectangle:
                size: self.size

        BoxLayout:
            SpacerHalf:
            PlayerPileWidget:
                id: player1crape
            PlayerPileWidget:
                id: player1waste
            PlayerPileWidget:
                id: player1stock
            SpacerHalf:
        BoxLayout:
            SpacerHalf:
            TableauLeftPileWidget:
                id: tableau4
            FoundationPileWidget:
                id: foundation4
            FoundationPileWidget:
                id: foundation3
            TableauRightPileWidget:
                id: tableau3
            SpacerHalf:
        BoxLayout:
            SpacerHalf:
            TableauLeftPileWidget:
                id: tableau5
            FoundationPileWidget:
                id: foundation5
            FoundationPileWidget:
                id: foundation2
            TableauRightPileWidget:
                id: tableau2
            SpacerHalf:
        BoxLayout:
            SpacerHalf:
            TableauLeftPileWidget:
                id: tableau6
            FoundationPileWidget:
                id: foundation6
            FoundationPileWidget:
                id: foundation1
            TableauRightPileWidget:
                id: tableau1
            SpacerHalf:
        BoxLayout:
            SpacerHalf:
            TableauLeftPileWidget:
                id: tableau7
            FoundationPileWidget:
                id: foundation7
            FoundationPileWidget:
                id: foundation0
            TableauRightPileWidget:
                id: tableau0
            SpacerHalf:
        BoxLayout:
            SpacerHalf:
            PlayerPileWidget:
                id: player0stock
            PlayerPileWidget:
                id: player0waste
            PlayerPileWidget:
                id: player0crape
            SpacerHalf:

        # BoxLayout:
        #     orientation: 'horizontal'
        #     size_hint: 1, None
        #     # height: app.menu_height
        #     # spacing: 0.01*win.Window.width
        #     # padding: app.pad_by, app.pad_by, app.pad_by, app.pad_by

        #     canvas.before:
        #         Color:
        #             rgba: 0.1, 0.4, 0.1, 1
        #         Rectangle:
        #             pos: self.pos
        #             size: self.size

        #     Spinner:
        #         id: menu
        #         text: "Menu"
        #         size_hint: None, None
        #         # size: 0.18*win.Window.width, app.menu_height-2*app.pad_by

        #     Button:
        #         text: 'CRAPETTE'
        #         on_press: app.crapette()

        #     Spinner:
        #         id: menu_smileys
        #         text: "Smileys :o)"
        #         size_hint: None, None
        #         # size: 0.18*win.Window.width, app.menu_height-2*app.pad_by


<TableauPileWidget@RelativeLayout>:
    size: app.card_width * (1 + 12 * app.card_overlap), app.card_height

    # canvas:
    #     Color:
    #         rgb: 1, 0, 0
    #     Rectangle:
    #         size: self.size

<TableauRightPileWidget@TableauPileWidget>:
    #pos_hint: {'x': 0, 'center_y': 0.5}

    PileBackground:
        pos_hint: {'x': 0, 'center_y': 0.5}
        # canvas:
        #     Color:
        #         rgb: 0, 0, 1
        #     Rectangle:
        #         size: self.size
        #         pos: self.pos

<TableauLeftPileWidget@TableauPileWidget>:
    #pos_hint: {'right': 1, 'center_y': 0.5}

    PileBackground:
        pos_hint: {'right': 1, 'center_y': 0.5}
        # canvas:
        #     Color:
        #         rgb: 0, 0, 1
        #     Rectangle:
        #         size: self.size
        #         pos: self.pos

<FoundationPileWidget@RelativeLayout>:
    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
    size_hint: None, 1
    size: self.height, self.height

    # canvas:
    #     Color:
    #         rgb: 0, 0, 1
    #     Rectangle:
    #         size: self.size

    FoundationBackground:
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
    FoundationSuit:
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
        source: "images/png/2x/suit-heart.png"

<PlayerPileWidget@RelativeLayout>:
    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
    size: app.card_width, app.card_height
    id: parent

    # canvas:
    #     Color:
    #         rgb: 1, 0, 0
    #     Rectangle:
    #         size: self.size

    PileBackground:
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}

    CardImage:
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
        source: parent.source
        opacity: 0 if parent.is_empty else 1

<CardImage@Image>:
    keep_ratio: True
    allow_stretch: True
    mipmap: True
    size: app.card_width, app.card_height

<PileBackground@CardImage>:
    source: 'images/png/2x/card-base.png'
    opacity: 0.1

<FoundationBackground@PileBackground>:
    canvas.before:
        PushMatrix
        Rotate:
            angle: 90
            axis: 0, 0, 1
            origin: self.center
    canvas.after:
        PopMatrix

<FoundationSuit@CardImage>:
    id: parent
    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
    size_hint: 1/3, 1/3
    opacity: 0.3

    canvas.before:
        PushMatrix
        Rotate:
            angle: 90 if "center_x" in parent.pos_hint and parent.pos_hint["center_x"] < 0.5 else -90
            axis: 0, 0, 1
            origin: root.center
    canvas.after:
        PopMatrix

<SpacerHalf@Widget>:
    size_hint: 0.5, 1

<MovingCard@Scatter>:
    id: parent

    size_hint: None, None
    size: app.card_width, app.card_height
    do_rotation: False
    do_scale: False
    auto_bring_to_front: True

    CardImage:
        source: parent.source

<NbCards@Label>:
    size_hint: None, None
    size: 50, 20
    halign: "center"
    valign: "top"
    text: "99"

#:kivy 1.10.0

FloatLayout:
    background: "images/background.png"

    canvas.before:
        Rectangle:
            pos: self.pos
            size: self.size
            source: "images/background.png"
    Widget:
        id: background_crapette
        opacity: 0
        canvas:
            Rectangle:
                pos: self.pos
                size: self.size
                source: "images/background-crapette.png"
    Widget:
        id: background_halo
        opacity: 0
        pos: 0, 0
        size_hint: None, None
        size: root.width, app.card_height * 2
        canvas:
            Rectangle:
                pos: self.x, self.y - app.card_height
                size: self.size
                source: "images/background-halo.png"

    BoxLayout:
        orientation: "vertical"
        size: root.size

        BoxLayout:
            CrapetteButton:
                id: player0crapebutton
            CardCount:
                id: player1crapecount
                halign: 'right'
            PlayerPileWidget:
                id: player1crape
            PlayerPileWidget:
                id: player1waste
            PlayerPileWidget:
                id: player1stock
            CardCount:
                id: player1stockcount
                halign: 'left'
            SpacerHalf:
        BoxLayout:
            SpacerHalf:
            TableauLeftPileWidget:
                id: tableau4
            FoundationPileWidgetLeft:
                id: foundation4
                background: "images/png/2x/suit-spade.png"
            FoundationPileWidgetRight:
                id: foundation3
                background: "images/png/2x/suit-spade.png"
            TableauRightPileWidget:
                id: tableau3
            SpacerHalf:
        BoxLayout:
            SpacerHalf:
            TableauLeftPileWidget:
                id: tableau5
            FoundationPileWidgetLeft:
                id: foundation5
                background: "images/png/2x/suit-heart.png"
            FoundationPileWidgetRight:
                id: foundation2
                background: "images/png/2x/suit-heart.png"
            TableauRightPileWidget:
                id: tableau2
            SpacerHalf:
        BoxLayout:
            SpacerHalf:
            TableauLeftPileWidget:
                id: tableau6
            FoundationPileWidgetLeft:
                id: foundation6
                background: "images/png/2x/suit-club.png"
            FoundationPileWidgetRight:
                id: foundation1
                background: "images/png/2x/suit-club.png"
            TableauRightPileWidget:
                id: tableau1
            SpacerHalf:
        BoxLayout:
            SpacerHalf:
            TableauLeftPileWidget:
                id: tableau7
            FoundationPileWidgetLeft:
                id: foundation7
                background: "images/png/2x/suit-diamond.png"
            FoundationPileWidgetRight:
                id: foundation0
                background: "images/png/2x/suit-diamond.png"
            TableauRightPileWidget:
                id: tableau0
            SpacerHalf:
        BoxLayout:
            SpacerHalf:
            CardCount:
                id: player0stockcount
                halign: 'right'
            PlayerPileWidget:
                id: player0stock
            PlayerPileWidget:
                id: player0waste
            PlayerPileWidget:
                id: player0crape
            CardCount:
                id: player0crapecount
                halign: 'left'
            CrapetteButton:
                id: player1crapebutton

    Button:
        text: 'New Game'
        on_press: app.new_game()
        pos: 0, 0
        size: 100, 50
        size_hint: None, None

        # BoxLayout:
        #     orientation: 'horizontal'
        #     size_hint: 1, None
        #     # height: app.menu_height
        #     # spacing: 0.01*win.Window.width
        #     # padding: app.pad_by, app.pad_by, app.pad_by, app.pad_by

        #     canvas.before:
        #         Color:
        #             rgba: 0.1, 0.4, 0.1, 1
        #         Rectangle:
        #             pos: self.pos
        #             size: self.size

        #     Spinner:
        #         id: menu
        #         text: "Menu"
        #         size_hint: None, None
        #         # size: 0.18*win.Window.width, app.menu_height-2*app.pad_by

        #     Button:
        #         text: 'CRAPETTE'
        #         on_press: app.crapette()

        #     Spinner:
        #         id: menu_smileys
        #         text: "Smileys :o)"
        #         size_hint: None, None
        #         # size: 0.18*win.Window.width, app.menu_height-2*app.pad_by


<TableauPileWidget@RelativeLayout>:
    size_hint: None, 1
    size: app.card_width * (1 + 12 * app.card_overlap), app.card_height

    # canvas:
    #     Color:
    #         rgb: 1, 0, 0
    #     Rectangle:
    #         size: self.size

<TableauRightPileWidget@TableauPileWidget>:
    PileBackground:
        pos_hint: {'x': 0, 'center_y': 0.5}

<TableauLeftPileWidget@TableauPileWidget>:
    PileBackground:
        pos_hint: {'right': 1, 'center_y': 0.5}

<FoundationPileWidget@RelativeLayout>:
    id: parent
    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
    size_hint: None, 1
    size: app.card_height if app.wide else app.card_width, app.card_height

    canvas.before:
        PushMatrix
        Rotate:
            angle: self.rotation
            axis: 0, 0, 1
            origin: self.height / 2, self.height / 2  # Why self.center doesn't work here ?
    canvas.after:
        PopMatrix

    PileBackground:
    FoundationSuit:
        source: parent.background

<FoundationPileWidgetLeft@FoundationPileWidget>:
    rotation: 90 if app.wide else 0

<FoundationPileWidgetRight@FoundationPileWidget>:
    rotation: -90 if app.wide else 0

<PlayerPileWidget@RelativeLayout>:
    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
    size_hint: None, 1
    size: self.height, self.height
    id: parent

    # canvas:
    #     Color:
    #         rgb: 1, 0, 0
    #     Rectangle:
    #         size: self.size

    PileBackground:

<CardImage@Image>:
    keep_ratio: True
    allow_stretch: True
    mipmap: True
    size: app.card_width, app.card_height
    pos_hint: {'center_x': 0.5, 'center_y': 0.5}

<PileBackground@CardImage>:
    source: 'images/png/1x/card-base.png'
    opacity: 0.1
    size_hint: None, None

<FoundationSuit@CardImage>:
    id: parent
    size_hint: None, None
    size: app.card_width / 3, app.card_width / 3
    opacity: 0.3

<SpacerHalf@Widget>:
    size_hint: 0.5, 1

<CardWidget@Scatter>:
    id: parent

    size_hint: None, None
    size: app.card_width, app.card_height
    do_rotation: False
    do_scale: False
    auto_bring_to_front: True

    CardImage:
        source: parent.source
        keep_ratio: False

<CardCount@Label>:
    size_hint: None, None
    size: app.card_width / 2, app.card_height
    text_size: app.card_width / 2, app.card_height
    valign: 'middle'

<CrapetteButton@Button>:
    text: 'Crapette !'
    on_press: app.board_manager.on_crapette()
    size_hint: 0.5, 1
    opacity: 0
    disabled: True
